Chủ đề: Refactor toàn diện tính năng Thuộc tính & Biến thể (Variants) của Sản phẩm.

Mục tiêu: Cải thiện UI/UX cho cả Admin (khi nhập sản phẩm) và Khách hàng (khi xem sản phẩm), đồng thời sửa lại logic tồn kho (stock) cho chính xác khi sản phẩm có biến thể.

Các file liên quan chính:

Scamphone-FE/src/components/admin/ProductForm.tsx (Form Admin)

Scamphone-FE/src/components/pages/ProductDetailPage.tsx (Trang khách hàng)

Scamphone-BE/Models/ProductModel.js (Cấu trúc dữ liệu)

Scamphone-FE/src/components/ProductCard.tsx (Card sản phẩm)

Scamphone-FE/src/components/admin/InventoryManagement.tsx (Context về hiển thị kho)

Phần 1: Cập nhật Form Admin (ProductForm.tsx)
Nhiệm vụ A: Giao diện Nhập Thuộc tính (Tag Input) (Như image_4a211f.png)

Tôi muốn thay đổi cách nhập "Giá trị" (Values) cho một "Thuộc tính" (Attribute).

Vấn đề: Hiện tại, người dùng phải nhập các giá trị như "Đen, Trắng, Xanh" vào một ô Input duy nhất, cách nhau bằng dấu phẩy (dùng hàm handleAttributeValuesChange).

Yêu cầu: Hãy refactor UI này:

Xóa ô Input (dòng 221) và hàm handleAttributeValuesChange.

Hiển thị các giá trị attr.values (ví dụ: ["Đen", "Trắng"]) dưới dạng các component Badge (thẻ).

Mỗi Badge phải có một nút X (icon X) nhỏ để khi click sẽ xóa giá trị đó khỏi mảng formData.attributes[index].values.

Bên cạnh các Badge này, thêm một ô Input nhỏ (ví dụ: placeholder="Thêm giá trị (nhấn Enter)...") và một Button "Thêm" (hoặc icon +).

Khi người dùng nhập vào ô input nhỏ và nhấn "Thêm" (hoặc nhấn Enter), hãy thêm giá trị mới đó vào mảng formData.attributes[index].values (nhớ setFormData) và reset ô input nhỏ đó.

Nhiệm vụ B: Logic Tồn Kho (Stock) cho Variant (Yêu cầu mới)

Tôi muốn thay đổi cách quản lý số lượng tồn kho (stock_quantity) dựa trên việc sản phẩm có biến thể hay không.

Logic:

Nếu không có thuộc tính: (formData.attributes.length === 0), thì ô Input "Số lượng" (tồn kho tổng, stock_quantity) phải được hiển thị và cho phép nhập tay.

Nếu CÓ thuộc tính: (formData.attributes.length > 0), thì ô Input "Số lượng" (stock_quantity) phải bị vô hiệu hóa (disabled) hoặc ẩn đi.

Nguồn dữ liệu kho:

Khi có thuộc tính, số lượng tồn kho của từng biến thể (variant.stock trong bảng "Quản lý Variants") sẽ do người dùng nhập tay.

Giá trị stock_quantity (tồn kho tổng của sản phẩm cha) sẽ được tự động tính toán bằng cách SUM (tổng) của tất cả variant.stock.

Cập nhật handleSubmit:

Trong hàm handleSubmit (quanh dòng 280), trước khi gửi productData đi:

Hãy kiểm tra nếu formData.variants.length > 0.

Nếu có, hãy tính totalStock = formData.variants.reduce((sum, v) => sum + parseInt(v.stock.toString()), 0).

Gán productData.stock_quantity = totalStock.

Điều này đảm bảo ProductModel ở backend và trang InventoryManagement.tsx luôn hiển thị tổng số lượng kho chính xác.

Phần 2: Cập nhật Trang Chi tiết Sản phẩm (ProductDetailPage.tsx)
Nhiệm vụ C: Hiển thị Giá và Tình trạng Kho trên Nút chọn (Như image_4a20de.png)

Tôi muốn cập nhật các nút chọn thuộc tính (Dung lượng, Màu sắc) để chúng hiển thị giá và tình trạng của biến thể đó.

Tham khảo file: Scamphone-FE/src/components/pages/ProductDetailPage.tsx (quanh dòng 149, vòng lặp product.attributes.map(...)).

Yêu cầu: Khi render mỗi Button cho một value (ví dụ: "Xám"):

Tìm biến thể (Variant):

Tạo một bản sao của selectedAttributes hiện tại.

Cập nhật bản sao đó với cặp [attr.name]: value của nút đang được render. (Ví dụ: nếu đang chọn '8GB-256GB', khi render nút 'Xám', attributes cần tìm là { "Dung Lượng": "8GB-256GB", "Màu sắc": "Xám" }).

Tìm trong product.variants một variant có attributes khớp chính xác với bản sao attributes ở trên.

Hiển thị:

Nếu tìm thấy variant:

Hiển thị variant.price (đã format) bên dưới text của nút (ví dụ: "13.599.000đ").

Nếu variant.stock === 0, hãy disabled Button này và hiển thị nó (ví dụ: thêm gạch chéo hoặc làm mờ).

Nếu không tìm thấy variant (do sự kết hợp thuộc tính đó không tồn tại):

Hãy disabled Button này.

Phần 3: Cải thiện Hiển thị Hình ảnh (CSS)
Nhiệm vụ D: Căn chỉnh Ảnh Sản phẩm 'Vừa khít'

Khi tôi thêm link ảnh sản phẩm, ảnh có thể bị méo hoặc không lấp đầy khung hình trên trang chủ và trang chi tiết.

Vấn đề: Các ảnh có tỷ lệ khung hình (aspect ratio) khác nhau.

Yêu cầu: Hãy đảm bảo ảnh sản phẩm luôn "vừa khít" và không bị méo.

Kiểm tra các file Scamphone-FE/src/components/ProductCard.tsx và Scamphone-FE/src/components/pages/ProductDetailPage.tsx (chỗ sử dụng ImageWithFallback).

Hãy bọc component ImageWithFallback trong một div cha.

Đặt cho div cha này một tỷ lệ khung hình cố định (ví dụ: aspect-square hoặc aspect-[4/3]) và overflow-hidden.

Thêm className="w-full h-full object-cover" cho ImageWithFallback để nó tự động lấp đầy div cha mà không bị biến dạng.